<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Professional Video Downloader</title>
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      color: #333;
    }

    .container {
      max-width: 900px;
      margin: 0 auto;
      padding: 20px;
    }

    .header {
      text-align: center;
      margin-bottom: 40px;
      animation: fadeInDown 1s ease-out;
    }

    .header h1 {
      color: white;
      font-size: 2.5rem;
      font-weight: 700;
      margin-bottom: 10px;
      text-shadow: 0 2px 4px rgba(0,0,0,0.3);
    }

    .header p {
      color: rgba(255,255,255,0.9);
      font-size: 1.1rem;
    }

    .input-section {
      background: rgba(255,255,255,0.95);
      backdrop-filter: blur(10px);
      border-radius: 20px;
      padding: 30px;
      box-shadow: 0 15px 35px rgba(0,0,0,0.1);
      margin-bottom: 30px;
      animation: fadeInUp 1s ease-out 0.3s both;
    }

    .input-group {
      display: flex;
      gap: 15px;
      margin-bottom: 15px;
    }

    .url-input {
      flex: 1;
      padding: 15px 20px;
      border: 2px solid #e1e5e9;
      border-radius: 50px;
      font-size: 16px;
      transition: all 0.3s ease;
      background: white;
    }

    .url-input:focus {
      outline: none;
      border-color: #667eea;
      box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
      transform: translateY(-2px);
    }

    .fetch-btn {
      padding: 15px 30px;
      background: linear-gradient(45deg, #667eea, #764ba2);
      color: white;
      border: none;
      border-radius: 50px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
      font-size: 16px;
      min-width: 120px;
    }

    .fetch-btn:hover {
      transform: translateY(-3px);
      box-shadow: 0 10px 25px rgba(102, 126, 234, 0.4);
    }

    .fetch-btn:active {
      transform: translateY(-1px);
    }

    .fetch-btn:disabled {
      opacity: 0.6;
      cursor: not-allowed;
      transform: none;
    }

    .error-message {
      color: #e74c3c;
      font-size: 14px;
      margin-top: 10px;
      display: flex;
      align-items: center;
      gap: 8px;
      animation: shake 0.5s ease-in-out;
    }

    .loading {
      text-align: center;
      padding: 40px;
      color: white;
      animation: fadeIn 0.5s ease-out;
    }

    .spinner {
      width: 50px;
      height: 50px;
      border: 4px solid rgba(255,255,255,0.3);
      border-top: 4px solid white;
      border-radius: 50%;
      animation: spin 1s linear infinite;
      margin: 0 auto 20px;
    }

    .video-info {
      background: rgba(255,255,255,0.95);
      backdrop-filter: blur(10px);
      border-radius: 20px;
      padding: 30px;
      box-shadow: 0 15px 35px rgba(0,0,0,0.1);
      animation: fadeInUp 0.6s ease-out;
    }

    .video-header {
      display: flex;
      gap: 20px;
      margin-bottom: 30px;
      align-items: flex-start;
    }

    .video-thumbnail {
      width: 200px;
      height: 150px;
      object-fit: cover;
      border-radius: 15px;
      box-shadow: 0 8px 20px rgba(0,0,0,0.1);
      transition: transform 0.3s ease;
    }

    .video-thumbnail:hover {
      transform: scale(1.05);
    }

    .video-details h3 {
      color: #2c3e50;
      font-size: 1.4rem;
      margin-bottom: 10px;
      line-height: 1.4;
    }

    .video-meta {
      display: flex;
      gap: 20px;
      margin-top: 15px;
    }

    .meta-item {
      display: flex;
      align-items: center;
      gap: 8px;
      color: #7f8c8d;
      font-size: 14px;
    }

    .formats-section {
      margin-top: 30px;
    }

    .formats-title {
      color: #2c3e50;
      font-size: 1.3rem;
      margin-bottom: 20px;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .format-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: 15px;
    }

    .format-card {
      background: white;
      border: 2px solid #ecf0f1;
      border-radius: 15px;
      padding: 20px;
      transition: all 0.3s ease;
      animation: fadeInUp 0.5s ease-out;
    }

    .format-card:hover {
      border-color: #667eea;
      transform: translateY(-5px);
      box-shadow: 0 10px 25px rgba(0,0,0,0.1);
    }

    .format-type {
      display: flex;
      align-items: center;
      gap: 10px;
      margin-bottom: 15px;
    }

    .type-badge {
      padding: 6px 12px;
      border-radius: 20px;
      font-size: 12px;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    .badge-video {
      background: #e8f4fd;
      color: #2980b9;
    }

    .badge-audio {
      background: #fef9e7;
      color: #f39c12;
    }

    .badge-video-audio {
      background: #edf7ed;
      color: #27ae60;
    }

    .format-specs {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 10px;
      margin-bottom: 20px;
    }

    .spec-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 8px 0;
      border-bottom: 1px solid #ecf0f1;
      font-size: 14px;
    }

    .spec-label {
      color: #7f8c8d;
      font-weight: 500;
    }

    .spec-value {
      color: #2c3e50;
      font-weight: 600;
    }

    .action-buttons {
      display: flex;
      gap: 10px;
      margin-top: 15px;
    }

    .download-btn {
      flex: 1;
      padding: 12px 20px;
      background: linear-gradient(45deg, #27ae60, #2ecc71);
      color: white;
      border: none;
      border-radius: 10px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      text-decoration: none;
      font-size: 14px;
    }

    .download-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 20px rgba(39, 174, 96, 0.3);
      color: white;
      text-decoration: none;
    }

    .download-btn:active {
      transform: translateY(0);
    }

    .preview-btn {
      flex: 1;
      padding: 12px 20px;
      background: linear-gradient(45deg, #3498db, #2980b9);
      color: white;
      border: none;
      border-radius: 10px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      text-decoration: none;
      font-size: 14px;
    }

    .preview-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 20px rgba(52, 152, 219, 0.3);
      color: white;
      text-decoration: none;
    }

    .preview-btn:active {
      transform: translateY(0);
    }

    .copyright {
      text-align: center;
      margin-top: 40px;
      padding: 20px;
      color: rgba(255,255,255,0.8);
      font-size: 14px;
      animation: fadeIn 1s ease-out 1s both;
    }

    @keyframes fadeInDown {
      from {
        opacity: 0;
        transform: translateY(-30px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    @keyframes fadeInUp {
      from {
        opacity: 0;
        transform: translateY(30px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }

    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    @keyframes shake {
      0%, 100% { transform: translateX(0); }
      25% { transform: translateX(-5px); }
      75% { transform: translateX(5px); }
    }

    @media (max-width: 768px) {
      .container {
        padding: 15px;
      }

      .header h1 {
        font-size: 2rem;
      }

      .input-group {
        flex-direction: column;
      }

      .video-header {
        flex-direction: column;
        text-align: center;
      }

      .video-thumbnail {
        width: 100%;
        max-width: 300px;
        margin: 0 auto;
      }

      .format-grid {
        grid-template-columns: 1fr;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <!-- Header -->
    <div class="header">
      <h1><i class="fas fa-video"></i> Professional Video Downloader</h1>
      <p>Download videos from Instagram, YouTube and more platforms with ease</p>
    </div>

    <!-- Input Section -->
    <div class="input-section">
      <div class="input-group">
        <input type="text" class="url-input" id="videoUrl" placeholder="ðŸ”— Paste your video URL here (Instagram, YouTube, etc.)" />
        <button class="fetch-btn" id="fetchBtn">
          <i class="fas fa-search"></i> Fetch Video
        </button>
      </div>
      <div id="urlError" class="error-message" style="display: none;">
        <i class="fas fa-exclamation-triangle"></i>
        <span></span>
      </div>
    </div>

    <!-- Loading -->
    <div id="loading" class="loading" style="display: none;">
      <div class="spinner"></div>
      <p><i class="fas fa-download"></i> Fetching video information...</p>
    </div>

    <!-- Video Info -->
    <div id="videoInfo" class="video-info" style="display: none;"></div>

    <!-- Copyright -->
    <div class="copyright">
      <p><i class="fas fa-copyright"></i> 2024 Professional Video Downloader by Asmit. All rights reserved.</p>
      <p><small>This tool respects content creators' rights. Please ensure you have permission to download content.</small></p>
    </div>
  </div>

  <script>
    const videoUrl = document.getElementById('videoUrl');
    const fetchBtn = document.getElementById('fetchBtn');
    const urlError = document.getElementById('urlError');
    const loading = document.getElementById('loading');
    const videoInfo = document.getElementById('videoInfo');

    // Add enter key support
    videoUrl.addEventListener('keypress', (e) => {
      if (e.key === 'Enter') {
        fetchBtn.click();
      }
    });

    fetchBtn.addEventListener('click', async () => {
      const url = videoUrl.value.trim();
      
      // Reset states
      hideError();
      videoInfo.style.display = 'none';
      
      // Validation
      if (!url) {
        showError('Please enter a video URL');
        return;
      }

      if (!isValidUrl(url)) {
        showError('Please enter a valid URL');
        return;
      }

      // Show loading
      showLoading();
      
      try {
        const response = await fetch(`https://instavideo-uhd.onrender.com/api/video-info?url=${encodeURIComponent(url)}`);
        const data = await response.json();
        
        hideLoading();
        
        if (!data.formats || data.formats.length === 0) {
          showError('No downloadable formats found for this video');
          return;
        }

        displayVideoInfo(data);
        
      } catch (error) {
        hideLoading();
        showError('Failed to fetch video information. Please try again.');
        console.error('Error:', error);
      }
    });

    function isValidUrl(string) {
      try {
        new URL(string);
        return true;
      } catch (_) {
        return false;
      }
    }

    function showError(message) {
      urlError.querySelector('span').textContent = message;
      urlError.style.display = 'flex';
    }

    function hideError() {
      urlError.style.display = 'none';
    }

    function showLoading() {
      fetchBtn.disabled = true;
      fetchBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Processing...';
      loading.style.display = 'block';
    }

    function hideLoading() {
      fetchBtn.disabled = false;
      fetchBtn.innerHTML = '<i class="fas fa-search"></i> Fetch Video';
      loading.style.display = 'none';
    }

    function displayVideoInfo(data) {
      const thumbnail = data.thumbnail || 'https://via.placeholder.com/200x150?text=No+Thumbnail';
      const title = data.title || 'Unknown Title';
      const duration = data.duration || 'Unknown';
      const uploader = data.uploader || 'Unknown';
      
      let html = `
        <div class="video-header">
          <img src="${thumbnail}" alt="Video Thumbnail" class="video-thumbnail" />
          <div class="video-details">
            <h3>${title}</h3>
            <div class="video-meta">
              <div class="meta-item">
                <i class="fas fa-clock"></i>
                <span>${formatDuration(duration)}</span>
              </div>
              <div class="meta-item">
                <i class="fas fa-user"></i>
                <span>${uploader}</span>
              </div>
            </div>
          </div>
        </div>

        <div class="formats-section">
          <h3 class="formats-title">
            <i class="fas fa-download"></i>
            Available Downloads
          </h3>
          <div class="format-grid">
      `;

      // Group and sort formats
      const sortedFormats = data.formats
        .filter(format => format.url)
        .sort((a, b) => {
          // Prioritize video with audio, then video only, then audio only
          const aScore = getFormatScore(a);
          const bScore = getFormatScore(b);
          
          if (aScore !== bScore) return bScore - aScore;
          
          // Then by quality (height)
          const aHeight = parseInt(a.height) || 0;
          const bHeight = parseInt(b.height) || 0;
          
          return bHeight - aHeight;
        });

      sortedFormats.forEach((format, index) => {
        const formatType = getFormatType(format);
        const quality = getQualityLabel(format);
        const size = formatFileSize(format.filesize);
        const extension = format.ext || 'mp4';
        
        html += `
          <div class="format-card" style="animation-delay: ${index * 0.1}s">
            <div class="format-type">
              <span class="type-badge ${formatType.class}">${formatType.label}</span>
              <span style="color: #7f8c8d; font-size: 12px;">${extension.toUpperCase()}</span>
            </div>
            
            <div class="format-specs">
              <div class="spec-item">
                <span class="spec-label">Quality</span>
                <span class="spec-value">${quality}</span>
              </div>
              <div class="spec-item">
                <span class="spec-label">Format</span>
                <span class="spec-value">${extension.toUpperCase()}</span>
              </div>
              ${format.vbr ? `<div class="spec-item">
                <span class="spec-label">Video Bitrate</span>
                <span class="spec-value">${format.vbr} kbps</span>
              </div>` : ''}
              ${format.abr ? `<div class="spec-item">
                <span class="spec-label">Audio Bitrate</span>
                <span class="spec-value">${format.abr} kbps</span>
              </div>` : ''}
            </div>
            
            <div class="action-buttons">
              ${format.vcodec && format.vcodec !== 'none' ? 
                `<button class="preview-btn" onclick="previewVideo('${format.url}', '${title}')">
                  <i class="fas fa-play"></i> Preview
                </button>` : ''}
              <button class="download-btn" onclick="downloadFile('${format.url}', '${title.replace(/[^a-zA-Z0-9]/g, '_')}.${extension}')">
                <i class="fas fa-download"></i> Download
              </button>
            </div>
          </div>
        `;
      });

      html += `
          </div>
        </div>
      `;

      videoInfo.innerHTML = html;
      videoInfo.style.display = 'block';
    }

    function getFormatType(format) {
      const hasVideo = format.vcodec && format.vcodec !== 'none';
      const hasAudio = format.acodec && format.acodec !== 'none';
      
      if (hasVideo && hasAudio) {
        return { label: 'Video with Audio', class: 'badge-video-audio' };
      } else if (hasVideo) {
        return { label: 'Video without Audio', class: 'badge-video' };
      } else if (hasAudio) {
        return { label: 'Audio', class: 'badge-audio' };
      } else {
        return { label: 'Unknown', class: 'badge-video' };
      }
    }

    function getFormatScore(format) {
      const hasVideo = format.vcodec && format.vcodec !== 'none';
      const hasAudio = format.acodec && format.acodec !== 'none';
      
      if (hasVideo && hasAudio) return 3;
      if (hasVideo) return 2;
      if (hasAudio) return 1;
      return 0;
    }

    function getQualityLabel(format) {
      if (format.height) {
        if (format.height >= 2160) return `4K (${format.height}p)`;
        if (format.height >= 1440) return `2K (${format.height}p)`;
        if (format.height >= 1080) return `Full HD (${format.height}p)`;
        if (format.height >= 720) return `HD (${format.height}p)`;
        if (format.height >= 480) return `SD (${format.height}p)`;
        return `${format.height}p`;
      } else if (format.abr) {
        if (format.abr >= 320) return `High Quality (${format.abr} kbps)`;
        if (format.abr >= 128) return `Medium Quality (${format.abr} kbps)`;
        return `${format.abr} kbps`;
      } else if (format.quality_label) {
        return format.quality_label;
      } else {
        return 'Standard Quality';
      }
    }

    function formatFileSize(bytes) {
      if (!bytes) return 'Unknown';
      
      const sizes = ['Bytes', 'KB', 'MB', 'GB'];
      const i = Math.floor(Math.log(bytes) / Math.log(1024));
      
      return Math.round(bytes / Math.pow(1024, i) * 100) / 100 + ' ' + sizes[i];
    }

    function formatDuration(seconds) {
      if (!seconds || isNaN(seconds)) return 'Unknown';
      
      const hrs = Math.floor(seconds / 3600);
      const mins = Math.floor((seconds % 3600) / 60);
      const secs = Math.floor(seconds % 60);
      
      if (hrs > 0) {
        return `${hrs}:${mins.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;
      } else {
        return `${mins}:${secs.toString().padStart(2, '0')}`;
      }
    }

    // Auto download function
    function downloadFile(url, filename) {
      // Create a temporary anchor element
      const link = document.createElement('a');
      link.href = url;
      link.download = filename;
      link.target = '_blank';
      
      // Append to body, click, and remove
      document.body.appendChild(link);
      link.click();
      document.body.removeChild(link);
      
      // Show feedback
      showDownloadFeedback();
    }

    // Preview video function
    function previewVideo(url, title) {
      // Create modal for video preview
      const modal = document.createElement('div');
      modal.style.cssText = `
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0,0,0,0.9);
        display: flex;
        align-items: center;
        justify-content: center;
        z-index: 10000;
        animation: fadeIn 0.3s ease-out;
      `;
      
      modal.innerHTML = `
        <div style="
          background: white;
          border-radius: 20px;
          padding: 20px;
          max-width: 90%;
          max-height: 90%;
          position: relative;
        ">
          <button onclick="this.closest('div').parentElement.remove()" style="
            position: absolute;
            top: 10px;
            right: 15px;
            background: #e74c3c;
            color: white;
            border: none;
            border-radius: 50%;
            width: 30px;
            height: 30px;
            cursor: pointer;
            font-size: 16px;
          ">&times;</button>
          <h3 style="margin-bottom: 15px; color: #2c3e50;">${title}</h3>
          <video controls style="width: 100%; max-width: 800px; border-radius: 10px;">
            <source src="${url}" type="video/mp4">
            Your browser does not support the video tag.
          </video>
        </div>
      `;
      
      // Close on background click
      modal.addEventListener('click', (e) => {
        if (e.target === modal) {
          modal.remove();
        }
      });
      
      document.body.appendChild(modal);
    }

    // Show download feedback
    function showDownloadFeedback() {
      const feedback = document.createElement('div');
      feedback.style.cssText = `
        position: fixed;
        top: 20px;
        right: 20px;
        background: linear-gradient(45deg, #27ae60, #2ecc71);
        color: white;
        padding: 15px 20px;
        border-radius: 10px;
        box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        z-index: 10000;
        animation: slideInRight 0.3s ease-out;
      `;
      
      feedback.innerHTML = `
        <i class="fas fa-check-circle"></i>
        Download started successfully!
      `;
      
      document.body.appendChild(feedback);
      
      // Remove after 3 seconds
      setTimeout(() => {
        feedback.style.animation = 'slideOutRight 0.3s ease-out';
        setTimeout(() => feedback.remove(), 300);
      }, 3000);
    }

    // Add CSS for animations
    const style = document.createElement('style');
    style.textContent = `
      @keyframes slideInRight {
        from {
          transform: translateX(100%);
          opacity: 0;
        }
        to {
          transform: translateX(0);
          opacity: 1;
        }
      }
      
      @keyframes slideOutRight {
        from {
          transform: translateX(0);
          opacity: 1;
        }
        to {
          transform: translateX(100%);
          opacity: 0;
        }
      }
    `;
    document.head.appendChild(style);
  </script>
</body>
</html>
